<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Jal Drishti - Water Management Platform" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Jal Drishti | Water Guard</title>
    
    <!-- Google Translate Widget Styling -->
    <style>
      /* Container for Google Translate */
      .translation-container {
        position: fixed !important;
        top: 70px !important;
        right: 20px !important;
        z-index: 9999999 !important;
        background: linear-gradient(145deg, #e6f7ff, #ffffff) !important;
        padding: 12px !important;
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        border: 3px solid #0066cc !important;
        min-width: 180px !important;
        max-width: 300px !important;
      }

      /* Label styles */
      .translate-label {
        display: block !important;
        font-weight: bold !important;
        margin-bottom: 8px !important;
        color: #0066cc !important;
        font-size: 16px !important;
        text-align: center !important;
        font-family: Arial, sans-serif !important;
      }

      /* Main Google element - ensure it's visible */
      #google_translate_element {
        display: block !important;
        width: 100% !important;
      }

      /* Google combobox styling */
      .goog-te-combo {
        width: 100% !important;
        padding: 8px 10px !important;
        font-size: 15px !important;
        border: 2px solid #0066cc !important;
        border-radius: 6px !important;
        background-color: white !important;
        color: #333333 !important;
        cursor: pointer !important;
        font-family: Arial, sans-serif !important;
        font-weight: 500 !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      }

      /* Fix top bar visibility */
      .skiptranslate {
        opacity: 1 !important;
      }

      /* Hide Google branding */
      .goog-logo-link {
        display: none !important;
      }
      .goog-te-gadget {
        color: transparent !important;
        font-size: 0px !important;
      }
      .goog-te-banner-frame {
        display: none !important;
      }
      body {
        top: 0px !important;
      }
      
      /* Make sure the widget is visible */
      iframe.goog-te-menu-frame {
        box-shadow: 0 3px 8px 2px rgba(0, 0, 0, 0.3) !important;
        display: block !important;
      }
      
      /* Direct translation buttons - as a fallback */
      .translate-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 10px;
      }
      
      .translate-button {
        background-color: #0066cc;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 12px;
        cursor: pointer;
        flex-grow: 1;
        text-align: center;
      }
      
      .translate-button:hover {
        background-color: #0055aa;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- Google Translate Implementation -->
    <div class="translation-container">
      <div class="translate-label">अनुवाद / Translate</div>
      <div id="google_translate_element"></div>
      
      <!-- Direct translation buttons as fallback -->
      <div class="translate-buttons">
        <button class="translate-button" onclick="translateTo('hi')">हिंदी</button>
        <button class="translate-button" onclick="translateTo('mr')">मराठी</button>
        <button class="translate-button" onclick="translateTo('te')">తెలుగు</button>
        <button class="translate-button" onclick="translateTo('ta')">தமிழ்</button>
        <button class="translate-button" onclick="translateTo('kn')">ಕನ್ನಡ</button>
        <button class="translate-button" onclick="translateTo('en')">English</button>
      </div>
    </div>

    <script type="text/javascript">
      // Global tracking for language
      window.currentLanguage = 'en';
      
      // Function to translate to a specific language
      function translateTo(lang) {
        if (!window.google || !window.google.translate) {
          console.error("Google Translate not loaded yet");
          alert("Translation service is still loading. Please try again in a moment.");
          return;
        }
        
        try {
          var select = document.querySelector('.goog-te-combo');
          if (select) {
            select.value = lang;
            select.dispatchEvent(new Event('change'));
          } else {
            // If dropdown not found, use URL-based translation as fallback
            var currentUrl = window.location.href;
            window.location.href = 'https://translate.google.com/translate?sl=auto&tl=' + 
                                 lang + '&u=' + encodeURIComponent(currentUrl);
          }
        } catch (error) {
          console.error("Error translating:", error);
        }
      }
      
      // Define the initialization function for Google Translate
      function googleTranslateElementInit() {
        try {
          new google.translate.TranslateElement(
            {
              pageLanguage: 'en',
              includedLanguages: 'en,hi,mr,te,ta,kn', // English, Hindi, Marathi, Telugu, Tamil, Kannada
              layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
              autoDisplay: true,
              // This is important - makes the dropdown trigger translation immediately
              gaTrack: false,
              gaId: 'UA-123456789-1'
            },
            'google_translate_element'
          );
          console.log("Google Translate widget initialized successfully");
          
          // Add listener to ensure the dropdown changes language immediately
          setTimeout(function() {
            var select = document.querySelector('.goog-te-combo');
            if (select) {
              select.addEventListener('change', function() {
                var event = document.createEvent('HTMLEvents');
                event.initEvent('change', true, true);
                select.dispatchEvent(event);
              });
            }
          }, 1000);
          
        } catch (error) {
          console.error("Error initializing Google Translate widget:", error);
        }
      }

      // Load the Google Translate script with retry mechanism
      function loadGoogleTranslateScript() {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
        
        script.onerror = function() {
          console.error("Failed to load Google Translate script. Retrying in 3 seconds...");
          setTimeout(loadGoogleTranslateScript, 3000);
        };
        
        document.head.appendChild(script);
      }

      // Ensure the widget is loaded after the page is fully loaded
      window.addEventListener('load', function() {
        // Wait a moment to ensure React has rendered
        setTimeout(loadGoogleTranslateScript, 1000);
        
        // Add a backup check to ensure the widget appears
        setTimeout(function() {
          if (!document.querySelector('.goog-te-combo')) {
            console.log("Widget not detected, forcing reload");
            loadGoogleTranslateScript();
          }
        }, 3000);
      });
    </script>
  </body>
</html>